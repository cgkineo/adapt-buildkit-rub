(function () {
	//console.log("Adapt Framework - loading...");

	if (!window.$) {
		//SUPPORT FOR V1.1.1 JQUERY SWAPPING >
		//Test for ie8
	    var IE = (function() { 
	        if (document.documentMode) {
	            return document.documentMode;
	        }
	        return false;
	    })();

	    //Load jquery
        Modernizr.load([
            {
                test: IE == 8,
                yep: 'libraries/jquery.js',
                nope: 'libraries/jquery.v2.js',
                complete: loadAdapt
            }
        ]);
        //< SUPPORT FOR V1.1.1 JQUERY SWAPPING
	} else loadAdapt();


	function loadAdapt() {

		require.config({
			baseUrl: "./", //FIX FOR MODERNIZER BASEURL CHANGES
			paths: {
				libraries: "adapt/js/libraries",
				core: "adapt/js/core",
				plugins: "adapt/js/plugins",
				templates: "adapt/js/templates",
			},
			map: {
				'*': {
						"a11y": "jquery.a11y", //FIX FOR MISNAMED JQUERY.A11Y LIBRARY
						'coreJS/libraries/bowser': 'bowser', //FIX FOR MISREFERENCED BOWSER LIBRARY
						'components/components': 'plugins', //REDIRECT OLD GRUNT BUILD LIBRARY 
						'extensions/extensions': 'plugins', //REDIRECT OLD GRUNT BUILD LIBRARY
						'theme/theme': 'plugins', //REDIRECT OLD GRUNT BUILD LIBRARY
						'menu/menu': 'plugins', //REDIRECT OLD GRUNT BUILD LIBRARY
			            "coreJS": "core/js", //REDIRECT FOR NEW MAPPINGS
			            "coreViews": "core/js/views", //REDIRECT FOR NEW MAPPINGS
			            "coreModels": "core/js/models", //REDIRECT FOR NEW MAPPINGS
			            "coreCollections": "core/js/collections", //REDIRECT FOR NEW MAPPINGS
			            "coreHelpers": "core/js/helpers" //REDIRECT FOR NEW MAPPINGS
			        }
		        },
			shim: {
				'templates': [
					'libraries'
				],
				'core': [
					'libraries',
					'templates'
				],
				'plugins': [
					'libraries',
					'core',
					'templates'
				]
			},
			waitSeconds: 20
		});

		require.onError = function(err) {
			alert(err);
		};

		require([
			'plugins'
		], function() {
			console.log("Adapt Framework - libraries, templates, core and plugins loaded");
		});
	}

})();
